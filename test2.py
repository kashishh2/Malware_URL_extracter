import pefile
import re

# Define regular expression patterns to match URLs and IPs
url_pattern = re.compile(r'https?://(?:[-\w.]|(?:%[\da-fA-F]{2}))+')
ip_pattern = re.compile(r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}')

# Open the executable file and read its contents
pe = pefile.PE('/Users/kashishhanda/Documents/Code works/Malware_URL_extracter/sample_malware.exe')

# Create a new text file to write the URLs and IPs to
with open('urls_and_ips.txt', 'w') as file:
    # Iterate through the sections in the file and search for URLs and IPs
    for section in pe.sections:
        data = section.get_data()
        urls = url_pattern.findall(data.decode('utf-8', errors='ignore'))
        ips = ip_pattern.findall(data.decode('utf-8', errors='ignore'))
        if urls or ips:
            print(f'Found {len(urls)} URLs and {len(ips)} IPs in section {section.Name}:\n')
            file.write(f'Found {len(urls)} URLs and {len(ips)} IPs in section {section.Name}:\n')
            if urls:
                file.write('URLs:\n')
                for url in urls:
                    print(url)
                    file.write(url + '\n')
            if ips:
                file.write('IPs:\n')
                for ip in ips:
                    print(ip)
                    file.write(ip + '\n')
        else:
            file.write(f'No URLs or IPs found in section {section.Name}\n')
            print(f'No URLs or IPs found in section {section.Name}\n')

pe.close()
